#include <16F877A.h>
#fuses XT, NOWDT, NOPROTECT, NOBROWNOUT, NOLVP, NOPUT, NOWRT, NODEBUG, NOCPD
#use delay(clock=4M)
#include <lcd420.c>

// LCD Pin Tanýmlarý
#define LCD_RS_PIN PIN_B1  // RS pini RB1'e baðlý
#define LCD_RW_PIN PIN_B2  // RW pini RB2'ye baðlý
#define LCD_E_PIN  PIN_B0  // E pini RB0'a baðlý
#define LCD_D4_PIN PIN_B4  // D4 pini RB4'e baðlý
#define LCD_D5_PIN PIN_B5  // D5 pini RB5'e baðlý
#define LCD_D6_PIN PIN_B6  // D6 pini RB6'ya baðlý
#define LCD_D7_PIN PIN_B7  // D7 pini RB7'ye baðlý

// Durumlarý belirleyen global deðiþkenler
int oyun_durumu = 0;  // 0: Baþlangýç, 1: Oyuncu 1 Zar Atýþý, 2: Oyuncu 2 Zar Atýþý
int oyuncu1_zarlar[3];  // Oyuncu 1 için zar deðerleri
int oyuncu2_zarlar[3];  // Oyuncu 2 için zar deðerleri
int oyuncu1_toplam = 0; // Oyuncu 1'in toplamý
int oyuncu2_toplam = 0; // Oyuncu 2'nin toplamý
int zar_sayisi = 0;     // Zar sayacý
int i = 0;              // Global 'i' deðiþkeni

// Timer0'ý kullanarak 1 ile 6 arasýnda rastgele zar sayýsý üretmek için fonksiyon
int zar_atisi() {
    int timer_value = get_timer0();  // Timer0'ýn o anki deðerini al
    set_timer0(0);  // Timer0'ý sýfýrla
    return (timer_value % 6) + 1;  // 1 ile 6 arasýnda rastgele sayý üret
}

// LED efekt fonksiyonu (sýrayla LED'leri hýzlý yakýp söndürme)
void led_efekti() {
    for (int j = 0; j < 8; j++) {
        delay_ms(20);
        output_high(PIN_D0 + j);  // RD0'dan RD7'ye sýrayla LED'leri yak
        delay_ms(20);             // LED yanma süre ý azaltýldý
        output_low(PIN_D0 + j);   // LED'i kapat
    }
}

// Kazanan için LED efekti (kazanma efekti)
void kazanan_led_efekti() {
    for (int k = 0; k < 3; k++) {  // Efekti 3 kez tekrarla
        for (int j = 0; j < 8; j++) {
            output_high(PIN_D0 + j); // Tüm LED'leri yak
        }
        delay_ms(200);
        for (int j = 0; j < 8; j++) {
            output_low(PIN_D0 + j); // Tüm LED'leri söndür
        }
        delay_ms(200);
    }
}

// Tüm LED'leri yak ve söndür (RD portu kullanýlýyor)
void tum_ledleri_yak() {
    for (int j = 0; j < 8; j++) {
        output_high(PIN_D0 + j);
    }
}

void tum_ledleri_sondur() {
    for (int j = 0; j < 8; j++) {
        output_low(PIN_D0 + j);
    }
}

void baslama_mesaji() {
    lcd_putc("\f");
    lcd_gotoxy(1, 1);
    printf(lcd_putc, "Oyuna baslamak");
    lcd_gotoxy(1, 2);
    printf(lcd_putc, "icin START'a basin");
}

void hosgeldiniz_mesaji() {
    for (i = 1; i <= 17; i++) {
        lcd_putc("\f");
        lcd_gotoxy(i, 1);
        printf(lcd_putc, "Hosgeldiniz!");
        delay_ms(30);
    }
}

void main() {
    lcd_init();  // LCD'yi baþlat
    set_tris_a(0x01);  // RA0 giriþ olarak ayarlandý (00000001)
    set_tris_c(0x03);  // RC0 ve RC1 giriþ olarak ayarlandý
    set_tris_d(0x00);  // RD0-RD7 LED çýkýþ olarak ayarlandý
    set_tris_b(0x00);  // RB0-RB7 çýkýþ olarak ayarlandý (LCD kullanýmý için)
    setup_timer_0(RTCC_INTERNAL | RTCC_DIV_256);

    lcd_putc("\f");
    lcd_gotoxy(1, 1);
    printf(lcd_putc, "Lutfen Oyunu");
    lcd_gotoxy(1, 2);
    printf(lcd_putc, "Calistir'a basin");

    tum_ledleri_sondur(); // Baþlangýçta tüm LED'leri kapat

    while(TRUE) {
        if (input(PIN_C1) == 1) {  // RESET butonu
            oyun_durumu = 0;
            zar_sayisi = 0;
            oyuncu1_toplam = 0;
            oyuncu2_toplam = 0;
            for (i = 0; i < 3; i++) {
                oyuncu1_zarlar[i] = 0;
                oyuncu2_zarlar[i] = 0;
            }
            lcd_putc("\f");
            lcd_gotoxy(1, 1);
            printf(lcd_putc, "Lutfen Oyunu");
            lcd_gotoxy(1, 2);
            printf(lcd_putc, "Calistir'a basin");
            tum_ledleri_sondur();
            continue;
        }

        if (oyun_durumu == 0 && input(PIN_C0)) {  // Baþlatma butonu
            buton_bekle(PIN_C0);
            hosgeldiniz_mesaji();
            baslama_mesaji();
            tum_ledleri_yak();
            delay_ms(500);
            tum_ledleri_sondur();
            oyun_durumu = 1;
        }
    }
}

