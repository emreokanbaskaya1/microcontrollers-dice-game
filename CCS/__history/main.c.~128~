#include <16F877A.h>
#fuses XT, NOWDT, NOPROTECT, NOBROWNOUT, NOLVP, NOPUT, NOWRT, NODEBUG, NOCPD
#use delay(clock=4M)
#include <lcd420.c>

// LCD Pin Tanýmlarý
#define LCD_RS_PIN PIN_B1
#define LCD_RW_PIN PIN_B2
#define LCD_E_PIN  PIN_B0
#define LCD_D4_PIN PIN_B4
#define LCD_D5_PIN PIN_B5
#define LCD_D6_PIN PIN_B6
#define LCD_D7_PIN PIN_B7

// Global deðiþkenler
int oyuncu1_zarlar[3] = {0};
int oyuncu2_zarlar[3] = {0};
int oyuncu1_toplam = 0, oyuncu2_toplam = 0;
int zar_sayisi = 0;

// Timer0 ile rastgele zar atýþý (1-6 arasýnda)
int zar_atisi() {
    int timer_value = get_timer0();
    set_timer0(0);
    return (timer_value % 6) + 1; // 1-6 arasýnda sayý döner
}

// Hoþgeldiniz mesajý hýzlý kaydýr
void hosgeldiniz_mesaji() {
    int pos;
    for (pos = 17; pos > 0; pos--) {
        lcd_putc("\f");
        lcd_gotoxy(pos, 1);
        printf(lcd_putc, "Hosgeldiniz!");
        delay_ms(100); // Daha hýzlý kayar
    }
}

// Zar sonuçlarýný ekrana yazdýr
void guncelle_lcd(int zar, int oyuncu) {
    lcd_putc("\f");
    if (oyuncu == 1) {
        lcd_gotoxy(1, 1);
        printf(lcd_putc, "P1: ");
        for (int i = 0; i <= zar_sayisi; i++) {
            printf(lcd_putc, "%d", oyuncu1_zarlar[i]);
            if (i < zar_sayisi) printf(lcd_putc, "+");
        }
    } else {
        lcd_gotoxy(1, 2);
        printf(lcd_putc, "P2: ");
        for (int i = 0; i <= zar_sayisi; i++) {
            printf(lcd_putc, "%d", oyuncu2_zarlar[i]);
            if (i < zar_sayisi) printf(lcd_putc, "+");
        }
    }
}

// Kazananý göster
void kazanan_mesaji() {
    lcd_putc("\f");
    lcd_gotoxy(1, 1);
    printf(lcd_putc, "P1: %d  P2: %d", oyuncu1_toplam, oyuncu2_toplam);
    delay_ms(1500);

    lcd_putc("\f");
    if (oyuncu1_toplam > oyuncu2_toplam) {
        lcd_gotoxy(1, 1);
        printf(lcd_putc, "P1 Kazandi!");
    } else if (oyuncu2_toplam > oyuncu1_toplam) {
        lcd_gotoxy(1, 1);
        printf(lcd_putc, "P2 Kazandi!");
    } else {
        lcd_gotoxy(1, 1);
        printf(lcd_putc, "Berabere!");
    }
    delay_ms(3000);
}

void main() {
    lcd_init();
    setup_timer_0(RTCC_INTERNAL | RTCC_DIV_256);

    while (TRUE) {
        // 1. ÇALIÞTIR Butonunu Bekleme
        lcd_putc("\f");
        lcd_gotoxy(1, 1);
        printf(lcd_putc, "Lutfen Calistir");
        lcd_gotoxy(1, 2);
        printf(lcd_putc, "butonuna basin!");

        while (!input(PIN_C0)); // ÇALIÞTIR butonu bekle
        delay_ms(200);
        
        hosgeldiniz_mesaji(); // Hoþgeldiniz mesajýný hýzlý kaydýr
        lcd_putc("\f");
        lcd_gotoxy(1, 1);
        printf(lcd_putc, "Oyuna baslamak");
        lcd_gotoxy(1, 2);
        printf(lcd_putc, "icin START'a basin");

        // 2. Zar Atýþlarý (P1 ve P2 sýrayla)
        zar_sayisi = 0;
        oyuncu1_toplam = 0;
        oyuncu2_toplam = 0;

        while (zar_sayisi < 3) {
            // P1 Zar Atýþý
            while (!input(PIN_A0)); // START butonu bekle
            delay_ms(200);
            oyuncu1_zarlar[zar_sayisi] = zar_atisi();
            oyuncu1_toplam += oyuncu1_zarlar[zar_sayisi];
            guncelle_lcd(oyuncu1_zarlar[zar_sayisi], 1);

            // P2 Zar Atýþý
            while (!input(PIN_A0)); // START butonu bekle
            delay_ms(200);
            oyuncu2_zarlar[zar_sayisi] = zar_atisi();
            oyuncu2_toplam += oyuncu2_zarlar[zar_sayisi];
            guncelle_lcd(oyuncu2_zarlar[zar_sayisi], 2);

            zar_sayisi++;
        }

        // 3. Kazananý Göster
        kazanan_mesaji();
    }
}

