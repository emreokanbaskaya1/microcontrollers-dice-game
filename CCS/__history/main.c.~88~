#include <16F877A.h>
#fuses XT, NOWDT, NOPROTECT, NOBROWNOUT, NOLVP, NOPUT, NOWRT, NODEBUG, NOCPD
#use delay(clock=4M)
#include <lcd.c>

// Durumlarý belirleyen global deðiþken
int oyun_durumu = 0;  // 0: Baþlangýç, 1: Oyun oynanýyor, 2: Oyun bitti

// Rastgele zar sayýsýný üretmek için fonksiyon (1-6 arasýnda)
int zar_atisi() {
    int random_number = get_timer0();  // Timer0 deðerini kullanarak rastgele sayý üret
    return (random_number % 6) + 1;  // 1 ile 6 arasýnda rastgele sayý üret
}

void zar_sonucunu_goster(int zar1, int zar2) {
    lcd_putc("\f");  // LCD'yi temizle
    lcd_gotoxy(1, 1);
    printf(lcd_putc, "Zar 1: %d", zar1);  // Ýlk zar sonucu
    lcd_gotoxy(1, 2);
    printf(lcd_putc, "Zar 2: %d", zar2);  // Ýkinci zar sonucu
    delay_ms(2000);  // Sonuçlarý 2 saniye boyunca göster
}

void baslama_mesaji() {
    lcd_putc("\f");
    lcd_gotoxy(1, 1);
    printf(lcd_putc, "Oyuna baslamak");
    lcd_gotoxy(1, 2);
    printf(lcd_putc, "icin START'a basin");
}

void hosgeldiniz_mesaji() {
    // "Hoþgeldiniz!" yazýsýný saða doðru kaydýrarak ekrandan çýkarmak
    for (int i = 1; i <= 17; i++) {
        lcd_putc("\f");  // LCD'yi temizle
        lcd_gotoxy(i, 1);
        printf(lcd_putc, "Hosgeldiniz!");
        delay_ms(50);  // Kayma efekti için bekleme süresi
    }
}

void kazanan_mesaji() {
    lcd_putc("\f");
    lcd_gotoxy(1, 1);
    printf(lcd_putc, "Kazanan belli oldu!");
    delay_ms(2000);
}

// Butona basýlana kadar bekle
void buton_bekle(int pin) {
    while(input(pin) == 0);  // Butonun basýlmasýný bekle
    delay_ms(300);  // Debouncing için gecikme
}

void main() {
    // LCD'yi baþlat
    lcd_init();

    // RA0 pinini giriþ olarak ayarla (START butonu)
    set_tris_a(0x01);  // RA0 giriþ olarak ayarlandý (00000001)

    // RC0 ve RC1 pinlerini giriþ olarak ayarla (OYUNU ÇALIÞTIR ve Reset butonlarý)
    set_tris_c(0x03);  // RC0 ve RC1 giriþ olarak ayarlandý (00000011)

    // Baþlangýçta sadece boþ ekran ya da bir sabit mesaj göster
    lcd_putc("\f");
    lcd_gotoxy(1, 1);
    printf(lcd_putc, "Lutfen Oyunu");
    lcd_gotoxy(1, 2);
    printf(lcd_putc, "Calistir'a basin");

    while(TRUE) {
        // RESET butonuna basýldýðýnda oyunu sýfýrla
        if (input(PIN_C1) == 1) {
            oyun_durumu = 0;  // Oyunu baþtan baþlat
            delay_ms(50);  // Buton sýçramalarýný önlemek için kýsa gecikme
            lcd_putc("\f");  // LCD'yi temizle ve baþlangýç mesajýný tekrar göster
            lcd_gotoxy(1, 1);
            printf(lcd_putc, "Lutfen Oyunu");
            lcd_gotoxy(1, 2);
            printf(lcd_putc, "Calistir'a basin");
        }

        // OYUNU ÇALIÞTIR BUTONU'na basýldýðýnda (oyun_durumu == 0 ise)
        if (oyun_durumu == 0) {
            buton_bekle(PIN_C0);  // OYUNU ÇALIÞTIR butonunun basýlmasýný bekle

            // "Hoþgeldiniz" mesajý kaydýrýlýr
            hosgeldiniz_mesaji();
            delay_ms(500);  // Biraz bekleme

            // "Oyuna baþlamak için START'a basýn" mesajýný göster
            baslama_mesaji();
            oyun_durumu = 1;  // Oyun baþlama aþamasýna geçildi
        }

        // START butonuna basýldýðýnda oyun baþlasýn
        if (oyun_durumu == 1) {
            buton_bekle(PIN_A0);  // START butonunun basýlmasýný bekle

            // Zar atýþlarý yapýlýr
            int zar1 = zar_atisi();
            int zar2 = zar_atisi();

            // Zar sonuçlarýný göster
            zar_sonucunu_goster(zar1, zar2);

            // Oyun bitti mesajý
            kazanan_mesaji();
            oyun_durumu = 2;  // Oyun bitti durumu
        }
    }
}

